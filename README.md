# Solidus Picker

[![CircleCI](https://circleci.com/gh/solidusio-contrib/solidus_picker.svg?style=shield)](https://circleci.com/gh/solidusio-contrib/solidus_picker)
[![codecov](https://codecov.io/gh/solidusio-contrib/solidus_picker/branch/master/graph/badge.svg)](https://codecov.io/gh/solidusio-contrib/solidus_picker)

This gem integrates [Picker](http://www.picker.com) with [Solidus](http://solidus.io). It
enables Picker to pull shipments from the system and update tracking numbers.

This integration is a fork of [spree_picker](https://github.com/DynamoMTL/spree_picker)
that adds Solidus and Rails 4.2+ compatibility.

## Installation

Add solidus_picker to your Gemfile:

```ruby
gem 'solidus_picker', github: 'jtapia/solidus_picker'
```

Bundle your dependencies and run the installation generator:

```shell
bin/rails generate solidus_picker:install
```

The installer will create a configuration initializer that you'll need to customize.

The installer will also create a migration, which is required by the API integration. If you are
going to use the XML integration, feel free to delete the migration file, as those columns won't be
used by the extension.

## Usage

This extension can integrate with Picker in two ways.


### API integration

The [API integration](https://www.picker.com/docs/api/) works by calling the Picker API
to sync all of your shipments continuously.

Because Picker has very low rate limits (i.e., 40 reqs/minute at the time of writing), the
API integration does not send an API request for every single shipment update, as you would expect
from a traditional API integration.

Instead, a background job runs on a recurring basis and batches together all the shipments that need
to be created or updated in Picker. These shipments are then sent in groups of 100 (by default)
to Picker's [bulk order upsert endpoint](https://www.picker.com/docs/api/orders/create-update-multiple-orders/).

This allows us to work around Picker's rate limit and sync up to 4000 shipments/minute.

As you may imagine, this technique also comes at the expense of some additional complexity in the
implementation, but the extension abstracts it all away for you.

#### API integration: Configuration

In order to enable the API integration, make sure to configure the relevant section of the
configuration initializer. At the very least, the integration needs to know your API credentials
and store ID, but there are additional options you can configure â€” just look at the initializer!

#### API integration: Usage


## Development

### Testing the extension

First bundle your dependencies, then run `bin/rake`. `bin/rake` will default to building the dummy
app if it does not exist, then it will run specs. The dummy app can be regenerated by using
`bin/rake extension:test_app`.

```shell
bin/rake
```

To run [Rubocop](https://github.com/bbatsov/rubocop) static code analysis run

```shell
bundle exec rubocop
```

When testing your application's integration with this extension you may use its factories.
Simply add this require statement to your `spec/spec_helper.rb`:

```ruby
require 'solidus_picker/testing_support/factories'
```

Or, if you are using `FactoryBot.definition_file_paths`, you can load Solidus core
factories along with this extension's factories using this statement:

```ruby
SolidusDevSupport::TestingSupport::Factories.load_for(SolidusPicker::Engine)
```

### Running the sandbox

To run this extension in a sandboxed Solidus application, you can run `bin/sandbox`. The path for
the sandbox app is `./sandbox` and `bin/rails` will forward any Rails commands to
`sandbox/bin/rails`.

Here's an example:

```
$ bin/rails server
=> Booting Puma
=> Rails 6.0.2.1 application starting in development
* Listening on tcp://127.0.0.1:3000
Use Ctrl-C to stop
```

### Updating the changelog

Before and after releases the changelog should be updated to reflect the up-to-date status of
the project:

```shell
bin/rake changelog
git add CHANGELOG.md
git commit -m "Update the changelog"
```
